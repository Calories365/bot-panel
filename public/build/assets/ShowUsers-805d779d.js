import{_ as E,c as g,r as h,z as l,A as T,o as D,v as L,b as _,u as t,d as N,e as f,f as i,g as y,w as V,n as $,F,h as j,x as A,i as v,j as r,m as H,B as k,L as I}from"./app-0435e394.js";import{u as O,_ as R}from"./usePagination-a1745630.js";import{B as W}from"./BotsConfirmatiomModal-b322e21c.js";import{B as q}from"./BotsButtonWarning-1c54a521.js";const G=[{label:"ID",key:"id",type:"default",action:null,limit:40},{label:"Имя",key:"name",type:"link",action:"show",limit:40},{label:"Юзернейм",key:"username",type:"link",action:"telegram",limit:100},{label:"Telegram ID",key:"telegram_id",type:"default",action:null,limit:40},{label:"Премиум",key:"premium",type:"checkbox",action:null,limit:40},{label:"Забанил Бота",key:"delete",type:"checkbox",action:null,limit:40},{label:"Боты пользователя",key:"bot_ids",type:"arrayLink",action:"showBot",limit:40},{label:"Удаление",key:"delete",type:"button",action:"delete",limit:40}];const J={key:0},K=["href"],Q={key:1,class:"row mb-2"},X={class:"col-2"},Y=H(" Экспорт "),Z={class:"card"},ee={name:"ShowUsers",emits:["handle"],setup(ae,{emit:te}){const s=j(),n=A(),w=g(()=>s.getters[k.users]),b=g(()=>s.getters[k.isSubmitting]),c=g(()=>s.getters[k.pagination]),d=h(""),B=[10,20,30,40,50],C="Количество пользователей на странице",p=h(!1),u=h(null),{currentPage:U,pageSize:S,handlePageChange:P,handlePageSizeChange:z}=O(s.dispatch,m,n.params.id);function m(e){const a={page:U.value,perPage:S.value};e&&(a.botId=e),s.dispatch(l.getUsers,a).then(()=>{console.log("Users loaded successfully",e?`for bot: ${e}`:"for all bots")}).catch(o=>{console.error("Failed to load users:",o)})}T(()=>n.params.id,(e,a)=>{e!==a&&(U.value=1,console.log("id: ",e),m(e))}),D(()=>{m(n.params.id)}),L(()=>{s.dispatch(l.destroyUsers)});const x=e=>{if(e.action==="delete"&&(u.value=e.id,p.value=!0),e.action==="show"&&v.push({name:"showUser",params:{id:e.id}}),e.action==="showBot"&&v.push({name:"showBot",params:{id:e.id}}),e.action==="telegram"&&window.open(`https://t.me/${e.data}`,"_blank"),e.action==="usersExport"){const a=n.params.id;s.dispatch(l.exportUsers,{botId:a}).then(o=>{d.value=o.downloadUrl})}},M=()=>{s.dispatch(l.deleteUser,{id:u.value}),u.value=null};return(e,a)=>(r(),_(F,null,[t(b)?(r(),N(I,{key:0})):f("",!0),i("div",{class:$([{loading:t(b)},"col-12"])},[d.value?(r(),_("div",J,[i("a",{href:d.value,download:""},"Скачать файл",8,K)])):f("",!0),y(W,{title:"Подтверждение действия",message:"Вы уверены, что хотите удалить этого пользователя?",showModal:p.value,"onUpdate:showModal":a[0]||(a[0]=o=>p.value=o),onConfirm:M},null,8,["showModal"]),t(w)?(r(),_("div",Q,[i("div",X,[y(q,{onClick:a[1]||(a[1]=o=>x({action:"usersExport"}))},{default:V(()=>[Y]),_:1})])])):f("",!0),i("div",Z,[y(R,{users:!0,"per-page-text":C,columns:t(G),data:t(w),"total-pages":t(c).totalPages,"current-page":t(c).currentPage,"page-size-options":B,"per-page":t(c).perPage,"onUpdate:pageChange":t(P),"onUpdate:pageSizeChange":t(z),"onUpdate:export":e.handleExport,onHandle:x},null,8,["columns","data","total-pages","current-page","per-page","onUpdate:pageChange","onUpdate:pageSizeChange","onUpdate:export"])])],2)],64))}},ie=E(ee,[["__scopeId","data-v-9ceafe3a"]]);export{ie as default};
